{% extends 'portal/base.html' %}

{% block title %}Chestionare | Administrare{% endblock %}

{% block content %}
<div class="d-flex align-items-center justify-content-between mb-3">
  <div>
    <h1 class="h5 mb-0">Chestionare</h1>
    <div class="text-muted small">Lista principală (fără chestionarele arhivate). Pentru restore, mergi în Arhivă.</div>
  </div>
  <div class="d-flex gap-2">
    <a class="btn btn-outline-secondary btn-sm" href="{% url 'admin_arhiva' %}"><i class="bi bi-archive me-1"></i>Arhivă</a>
    <a class="btn btn-primary btn-sm" href="{% url 'admin_chestionar_create' %}"><i class="bi bi-plus-lg me-1"></i>Chestionar nou</a>
  </div>
</div>

<div class="card shadow-sm gov-card">
  <div class="card-body">
    {% if chestionare %}
      <div class="table-responsive">
        <table class="table align-middle">
          <thead>
            <tr>
              <th>Titlu</th>
              <th>Termen limită</th>
              <th>Capitole / criterii</th>
              <th class="text-end">Răspunsuri</th>
              <th class="text-end"></th>
            </tr>
          </thead>
          <tbody>
            {% for c in chestionare %}
              <tr>
                <td>
                  <div class="fw-semibold">{{ c.titlu }}</div>
                  {% if c.descriere %}<div class="text-muted small">{{ c.descriere|truncatechars:90 }}</div>{% endif %}
                </td>
                <td>
                  {{ c.termen_limita|date:"d.m.Y H:i" }}
                  {% if c.este_deschis %}
                    <div><span class="badge text-bg-success">Deschis</span></div>
                  {% else %}
                    <div><span class="badge text-bg-secondary">Închis</span></div>
                  {% endif %}
                </td>
                <td>
                  <div class="d-flex flex-wrap gap-1">
                    {% for ch in c.capitole.all %}<span class="badge text-bg-light"><i class="bi {{ ch.pictograma|default:'bi-journal-text' }} me-1"></i>{{ ch.numar }}</span>{% endfor %}
                    {% for cr in c.criterii.all %}<span class="badge text-bg-light"><i class="bi {{ cr.pictograma|default:'bi-flag' }} me-1"></i>{{ cr.cod }}</span>{% endfor %}
                  </div>
                </td>
                <td class="text-end">
                  <span class="badge text-bg-light">{{ c.submisii.count }}</span>
                </td>
                <td class="text-end">
                  <a class="btn btn-sm btn-outline-primary" href="{% url 'admin_chestionar_edit' c.pk %}">Editează</a>
                  <a class="btn btn-sm btn-outline-secondary" href="{% url 'admin_chestionar_raspunsuri' c.pk %}"><i class="bi bi-table me-1"></i>Răspunsuri</a>
                  <a class="btn btn-sm btn-outline-danger" href="{% url 'admin_chestionar_arhivare' c.pk %}?next=/administrare/chestionare/"><i class="bi bi-archive me-1"></i>Arhivează</a>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <div class="text-muted">Nu există chestionare.</div>
    {% endif %}
  </div>
</div>
{% endblock %}
