{% extends 'portal/base.html' %}

{% block title %}Newslettere | Administrare{% endblock %}

{% block content %}
<div class="d-flex align-items-center justify-content-between mb-3">
  <div>
    <h1 class="h5 mb-0">Newslettere</h1>
    <div class="text-muted small">Creează și trimite emailuri către toți experții. Newsletterele trimise sunt vizibile și în conturile experților ("vezi online"). Poți actualiza conținutul pentru varianta din platformă chiar și după trimiterea emailului.</div>
  </div>
  <div class="d-flex gap-2">
    <a class="btn btn-primary btn-sm" href="{% url 'admin_newsletter_create' %}"><i class="bi bi-plus-lg me-1"></i>Newsletter nou</a>
  </div>
</div>

<div class="card shadow-sm gov-card">
  <div class="card-body">
    {% if newsletters %}
      <div class="table-responsive">
        <table class="table align-middle">
          <thead>
            <tr>
              <th>Subiect</th>
              <th>Creat</th>
              <th>Status</th>
              <th class="text-end">Trimise</th>
              <th class="text-end"></th>
            </tr>
          </thead>
          <tbody>
            {% for n in newsletters %}
              <tr>
                <td>
                  <div class="fw-semibold">{{ n.subiect }}</div>
                  {% if n.continut %}
                    <div class="text-muted small">{{ n.continut|truncatechars:120 }}</div>
                  {% endif %}
                </td>
                <td class="text-nowrap">{{ n.creat_la|date:"d.m.Y H:i" }}</td>
                <td>
                  {% if n.este_trimis %}
                    <span class="badge text-bg-success"><i class="bi bi-envelope-check me-1"></i>Trimis</span>
                    <div class="text-muted small">{{ n.trimis_la|date:"d.m.Y H:i" }}</div>
                  {% else %}
                    <span class="badge text-bg-secondary"><i class="bi bi-pencil-square me-1"></i>Ciornă</span>
                  {% endif %}
                </td>
                <td class="text-end">
                  {% if n.este_trimis %}
                    <span class="badge text-bg-light">{{ n.nr_trimise }}/{{ n.nr_destinatari }}</span>
                    {% if n.nr_esecuri %}<div class="text-danger small">Eșecuri: {{ n.nr_esecuri }}</div>{% endif %}
                  {% else %}
                    <span class="text-muted">—</span>
                  {% endif %}
                </td>
                <td class="text-end">
                  <a class="btn btn-sm btn-outline-primary" href="{% url 'admin_newsletter_edit' n.pk %}"><i class="bi bi-pencil me-1"></i>Deschide</a>
                  {% if not n.este_trimis %}
                    <a class="btn btn-sm btn-outline-success" href="{% url 'admin_newsletter_send' n.pk %}"><i class="bi bi-send me-1"></i>Trimite</a>
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <div class="text-muted">Nu există newslettere.</div>
    {% endif %}
  </div>
</div>
{% endblock %}
