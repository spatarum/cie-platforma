{% extends 'portal/base.html' %}

{% block title %}Experți | Administrare{% endblock %}

{% block content %}
<div class="d-flex align-items-center justify-content-between mb-3">
  <div>
    <h1 class="h5 mb-0">Experți</h1>
    <div class="text-muted small">Lista principală (fără experții arhivați). Pentru restore, mergi în Arhivă.</div>
  </div>
  {% if request.user.is_superuser %}
    <div class="d-flex gap-2">
      <a class="btn btn-outline-secondary btn-sm" href="{% url 'admin_arhiva' %}"><i class="bi bi-archive me-1"></i>Arhivă</a>
      <a class="btn btn-outline-primary btn-sm" href="{% url 'admin_expert_import' %}"><i class="bi bi-upload me-1"></i>Import CSV</a>
      <a class="btn btn-primary btn-sm" href="{% url 'admin_expert_create' %}"><i class="bi bi-person-plus me-1"></i>Expert nou</a>
    </div>
  {% endif %}
</div>

<div class="card shadow-sm gov-card">
  <div class="card-body">
    {% if experti %}
      <div class="table-responsive">
        <table class="table align-middle">
          <thead>
            <tr>
              <th>Nume</th>
              <th>Email</th>
              <th>Organizație / funcție</th>
              <th class="text-nowrap">Ultima logare</th>
              <th class="text-end">Logări</th>
              <th class="text-end"></th>
            </tr>
          </thead>
          <tbody>
            {% for e in experti %}
              <tr>
                <td class="fw-semibold">{{ e.get_full_name|default:e.username }}</td>
                <td>{{ e.email }}</td>
                <td class="text-muted">
                  {% if e.profil_expert.organizatie %}{{ e.profil_expert.organizatie }}{% endif %}
                  {% if e.profil_expert.functie %}<div class="small">{{ e.profil_expert.functie }}</div>{% endif %}
                </td>
                <td class="text-nowrap">
                  {% if e.profil_expert.ultima_logare_la %}{{ e.profil_expert.ultima_logare_la|date:"d.m.Y" }}{% else %}<span class="text-muted">—</span>{% endif %}
                </td>
                <td class="text-end">{{ e.profil_expert.numar_logari|default:0 }}</td>
                <td class="text-end">
                  {% if request.user.is_superuser %}
                    <a class="btn btn-sm btn-outline-primary" href="{% url 'admin_expert_edit' e.pk %}">Editează</a>
                    <a class="btn btn-sm btn-outline-danger" href="{% url 'admin_expert_arhivare' e.pk %}?next=/administrare/experti/">
                      <i class="bi bi-archive me-1"></i>Arhivează
                    </a>
                  {% else %}
                    <a class="btn btn-sm btn-outline-primary" href="{% url 'admin_expert_edit' e.pk %}">Detalii</a>
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <div class="text-muted">Nu există experți.</div>
    {% endif %}
  </div>
</div>
{% endblock %}
